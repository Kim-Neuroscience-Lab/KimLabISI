{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ISI Macroscope Generation Parameters",
  "description": "JSON schema for stimulus generation parameters following ADR-0007 parameter separation",
  "type": "object",
  "properties": {
    "spatial_config": {
      "type": "object",
      "title": "Spatial Configuration",
      "description": "Monitor setup and visual field geometry parameters",
      "properties": {
        "monitor_distance_cm": {
          "type": "number",
          "minimum": 5.0,
          "maximum": 20.0,
          "default": 10.0,
          "description": "Distance from mouse eye to monitor in cm (Marshel et al.: 10cm)"
        },
        "monitor_angle_degrees": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 45.0,
          "default": 20.0,
          "description": "Monitor angle inward toward nose in degrees (Marshel et al.: 20°)"
        },
        "monitor_height_degrees": {
          "type": "number",
          "minimum": -15.0,
          "maximum": 15.0,
          "default": 0.0,
          "description": "Monitor elevation relative to eye level in degrees"
        },
        "monitor_roll_degrees": {
          "type": "number",
          "minimum": -10.0,
          "maximum": 10.0,
          "default": 0.0,
          "description": "Monitor roll rotation in degrees"
        },
        "screen_width_cm": {
          "type": "number",
          "minimum": 10.0,
          "maximum": 100.0,
          "default": 52.0,
          "description": "Physical screen width in cm"
        },
        "screen_height_cm": {
          "type": "number",
          "minimum": 10.0,
          "maximum": 100.0,
          "default": 52.0,
          "description": "Physical screen height in cm"
        },
        "screen_width_pixels": {
          "type": "integer",
          "minimum": 640,
          "maximum": 4096,
          "default": 2048,
          "description": "Screen resolution width in pixels"
        },
        "screen_height_pixels": {
          "type": "integer",
          "minimum": 480,
          "maximum": 4096,
          "default": 2048,
          "description": "Screen resolution height in pixels"
        },
        "field_of_view_horizontal_degrees": {
          "type": "number",
          "minimum": 10.0,
          "maximum": 180.0,
          "default": 147.0,
          "description": "Horizontal visual field coverage in degrees (Marshel et al.: 147°)"
        },
        "field_of_view_vertical_degrees": {
          "type": "number",
          "minimum": 10.0,
          "maximum": 180.0,
          "default": 153.0,
          "description": "Vertical visual field coverage in degrees (Marshel et al.: 153°)"
        }
      },
      "required": [
        "monitor_distance_cm",
        "monitor_angle_degrees",
        "screen_width_cm",
        "screen_height_cm",
        "screen_width_pixels",
        "screen_height_pixels",
        "field_of_view_horizontal_degrees",
        "field_of_view_vertical_degrees"
      ],
      "additionalProperties": false
    },
    "stimulus_params": {
      "type": "object",
      "title": "Stimulus Generation Parameters",
      "description": "Parameters affecting visual content of generated stimuli",
      "properties": {
        "bar_width_degrees": {
          "type": "number",
          "minimum": 1.0,
          "maximum": 45.0,
          "default": 20.0,
          "description": "Bar width in degrees of visual angle (Marshel et al.: 20°)"
        },
        "drift_speed_degrees_per_sec": {
          "type": "number",
          "minimum": 1.0,
          "maximum": 50.0,
          "default": 9.0,
          "description": "Bar drift speed in degrees per second (Marshel et al.: 8.5-9.5°/s)"
        },
        "pattern_type": {
          "type": "string",
          "enum": ["counter_phase_checkerboard", "solid", "grating"],
          "default": "counter_phase_checkerboard",
          "description": "Type of pattern within stimulus (Marshel et al.: counter-phase checkerboard)"
        },
        "checkerboard_size_degrees": {
          "type": "number",
          "minimum": 1.0,
          "maximum": 50.0,
          "default": 25.0,
          "description": "Checkerboard square size in degrees (Marshel et al.: 25°)"
        },
        "flicker_frequency_hz": {
          "type": "number",
          "minimum": 1.0,
          "maximum": 30.0,
          "default": 6.0,
          "description": "Counter-phase flicker frequency in Hz (Marshel et al.: 166ms period H 6Hz)"
        },
        "contrast": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "default": 0.5,
          "description": "Stimulus contrast (0-1, full black to white)"
        },
        "background_luminance": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "default": 0.5,
          "description": "Background luminance (0-1)"
        },
        "spherical_correction": {
          "type": "boolean",
          "default": true,
          "description": "Apply spherical coordinate correction (Marshel et al. method)"
        },
        "coordinate_system": {
          "type": "string",
          "enum": ["spherical", "cartesian"],
          "default": "spherical",
          "description": "Coordinate system for stimulus generation"
        },
        "bit_depth": {
          "type": "integer",
          "enum": [8, 16],
          "default": 8,
          "description": "Bit depth for stimulus frames"
        },
        "compression_level": {
          "type": "integer",
          "minimum": 0,
          "maximum": 9,
          "default": 6,
          "description": "HDF5 compression level (0=none, 9=max)"
        }
      },
      "required": [
        "bar_width_degrees",
        "drift_speed_degrees_per_sec",
        "pattern_type",
        "checkerboard_size_degrees",
        "flicker_frequency_hz",
        "contrast",
        "background_luminance",
        "spherical_correction",
        "coordinate_system"
      ],
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "title": "Parameter Metadata",
      "description": "Metadata for parameter tracking and validation",
      "properties": {
        "parameter_source": {
          "type": "string",
          "enum": ["default", "user_config", "parameter_store", "session_loaded"],
          "description": "Source of parameter values"
        },
        "created_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When parameters were created"
        },
        "modified_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When parameters were last modified"
        },
        "version": {
          "type": "string",
          "default": "1.0",
          "description": "Parameter schema version"
        },
        "generation_hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA256 hash for generation parameter matching"
        },
        "literature_reference": {
          "type": "string",
          "default": "Marshel et al. 2011",
          "description": "Literature reference for parameter values"
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["spatial_config", "stimulus_params"],
  "additionalProperties": false,
  "examples": [
    {
      "spatial_config": {
        "monitor_distance_cm": 10.0,
        "monitor_angle_degrees": 20.0,
        "monitor_height_degrees": 0.0,
        "monitor_roll_degrees": 0.0,
        "screen_width_cm": 52.0,
        "screen_height_cm": 52.0,
        "screen_width_pixels": 2048,
        "screen_height_pixels": 2048,
        "field_of_view_horizontal_degrees": 147.0,
        "field_of_view_vertical_degrees": 153.0
      },
      "stimulus_params": {
        "bar_width_degrees": 20.0,
        "drift_speed_degrees_per_sec": 9.0,
        "pattern_type": "counter_phase_checkerboard",
        "checkerboard_size_degrees": 25.0,
        "flicker_frequency_hz": 6.0,
        "contrast": 0.5,
        "background_luminance": 0.5,
        "spherical_correction": true,
        "coordinate_system": "spherical",
        "bit_depth": 8,
        "compression_level": 6
      },
      "metadata": {
        "parameter_source": "default",
        "version": "1.0",
        "literature_reference": "Marshel et al. 2011"
      }
    }
  ]
}